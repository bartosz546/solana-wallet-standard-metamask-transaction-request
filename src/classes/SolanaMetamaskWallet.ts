import {getWallets, Wallet} from "@wallet-standard/core";
import {
  address,
  appendTransactionMessageInstruction,
  assertIsTransactionMessageWithSingleSendingSigner,
  createSolanaRpc,
  createTransactionMessage,
  devnet,
  getBase58Decoder,
  pipe,
  setTransactionMessageFeePayerSigner,
  setTransactionMessageLifetimeUsingBlockhash,
  signAndSendTransactionMessageWithSigners
} from "@solana/kit";
import {getTransferSolInstruction} from "@solana-program/system";
import {
  SolanaSignMessage,
} from "@solana/wallet-standard-features";
import {CryptoWallet} from "./CryptoWallet";
import {ISignedMessage} from "./ISignedMessage";
import {SolanaMetamaskTransferSignerGenerator} from "./SolanaMetamaskTransferSignerGenerator";

export class SolanaMetamaskWallet extends CryptoWallet {

  private account: any;

  constructor() {
    super();

  }

  getId(): string {
    return "SolanaMetamask";
  }

  public getName(): string {
    return "Metamask";
  }

  public isAvailableOnMobileOrTablet(): boolean {
    return true;
  }

  public getLogoAddress(): string {
    return "data:image/png;base64,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bnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICB4bXBNTTpEb2N1bWVudElEPSJnaW1wOmRvY2lkOmdpbXA6MWY0MzY3YjQtMWY4MS00YTU2LWEzMzUtZmQ0M2I2ZDVmNDE5IgogICB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOmZkMjU3YTVmLTcxNjAtNGQ5Yy1iNzA2LWEzNjU5Nzk2ODk5NiIKICAgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjhhYTkyNzU0LWExZDAtNDAzYy04MGMxLTQxYjFlNzI2ZjkxMCIKICAgZGM6Rm9ybWF0PSJpbWFnZS9wbmciCiAgIEdJTVA6QVBJPSIyLjAiCiAgIEdJTVA6UGxhdGZvcm09IldpbmRvd3MiCiAgIEdJTVA6VGltZVN0YW1wPSIxNzI4MDU2ODg5OTk4NzYxIgogICBHSU1QOlZlcnNpb249IjIuMTAuMzIiCiAgIHRpZmY6T3JpZW50YXRpb249IjEiCiAgIHhtcDpDcmVhdG9yVG9vbD0iR0lNUCAyLjEwIgogICB4bXA6TWV0YWRhdGFEYXRlPSIyMDI0OjEwOjA0VDE3OjQ4OjA5KzAyOjAwIgogICB4bXA6TW9kaWZ5RGF0ZT0iMjAyNDoxMDowNFQxNzo0ODowOSswMjowMCI+CiAgIDx4bXBNTTpIaXN0b3J5PgogICAgPHJkZjpTZXE+CiAgICAgPHJkZjpsaQogICAgICBzdEV2dDphY3Rpb249InNhdmVkIgogICAgICBzdEV2dDpjaGFuZ2VkPSIvIgogICAgICBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjc3M2NiZWZjLWYwYmUtNGRmNC05ZDc4LTNkNDY2MGU2OGI0ZCIKICAgICAgc3RFdnQ6c29mdHdhcmVBZ2VudD0iR2ltcCAyLjEwIChXaW5kb3dzKSIKICAgICAgc3RFdnQ6d2hlbj0iMjAyMy0wNS0wOFQxNzowNjozMSIvPgogICAgIDxyZGY6bGkKICAgICAgc3RFdnQ6YWN0aW9uPSJzYXZlZCIKICAgICAgc3RFdnQ6Y2hhbmdlZD0iLyIKICAgICAgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDplZjE2MzIzZS1mM2MxLTQ0MTQtYjEyNS02ODU1OWMyZmE1ODkiCiAgICAgIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkdpbXAgMi4xMCAoV2luZG93cykiCiAgICAgIHN0RXZ0OndoZW49IjIwMjMtMDYtMDlUMTM6NTk6MjEiLz4KICAgICA8cmRmOmxpCiAgICAgIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiCiAgICAgIHN0RXZ0OmNoYW5nZWQ9Ii8iCiAgICAgIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6ZDc1NWI5YzgtODMyYi00OTg1LTliNDItNGEyY2Q1YzcxYThmIgogICAgICBzdEV2dDpzb2Z0d2FyZUFnZW50PSJHaW1wIDIuMTAgKFdpbmRvd3MpIgogICAgICBzdEV2dDp3aGVuPSIyMDI0LTEwLTA0VDE3OjQ4OjA5Ii8+CiAgICA8L3JkZjpTZXE+CiAgIDwveG1wTU06SGlzdG9yeT4KICA8L3JkZjpEZXNjcmlwdGlvbj4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/PkHPmY8AAAAGYktHRAA2AIEArZ+yWLsAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfoCgQPMAle13XTAAAJC0lEQVRYw7WZW2ycxRWAv5n5/717d+11NrGdCyZ2ShIiNRcSUOgLIJUgLqINKdCLBEWFtFJ4Q5WqvBSpfahaKvIAavPQB5qWEAHloSmKCA+IApFISIIdhRgcA4mTOLZ3be/uv/9lpg+7WXu9axsSd6TVSvufmfn+M+ecOees4DrHxnWP3CGlvAvYCvQCHQiRBsCY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";
  }

  public isInstalled(): boolean {
    if (!(window as any).ethereum) {
      return false;
    }

    return !!(window as any).ethereum.isMetaMask;
  }

  public redirectIntoWalletDAppPage(): void {
    const location = window.location.host;
    const url: string = "https://link.metamask.io/dapp/" + encodeURIComponent(location);
    window.open(url, "_blank");
  }

  public showWalletOfficialInstallPage(): void {
    window.open("https://metamask.io/download/", "_blank");
  }

  public async enable(): Promise<any> {
    if(this.account) {
      return this.account;
    }

    const metamaskWallet: any = this.getSolanaMetamaskWallet();

    try {
      const metamaskProvider = (window as any).ethereum.providers.find((p: any) => p.isMetaMask && !p.overrideIsMetaMask);
      await metamaskProvider.request({method: 'wallet_revokePermissions', params: [{eth_accounts: {}}],});
    } catch (e) {
      console.error(e);
    }

    const response = await metamaskWallet.features["standard:connect"].connect();
    this.account = response.accounts[0];
    return this.account;
  }

  public async getAddress(): Promise<string> {
    return await this.getHexedAddress();
  }

  public async signData(data: string): Promise<ISignedMessage> {
    const metamaskWallet: any = this.getSolanaMetamaskWallet();
    const account = await this.enable();

    const response = await metamaskWallet.features[SolanaSignMessage].signMessage({
      message: (new TextEncoder()).encode(data),
      account: account,
    });

    return {
      signature: Array.from(response[0].signature),
      key: account.address,
      address: account.address,
      stakeAddress: account.address
    };
  }

  public async sendTransfer(addressArg: string, amount: number): Promise<string> {
    const connection = createSolanaRpc(devnet('https://api.devnet.solana.com'));

    const { value: latestBlockhash } = await connection.getLatestBlockhash({ commitment: 'confirmed' }).send();

    const metamaskWallet: any = this.getSolanaMetamaskWallet();
    const account = await this.enable();

    const transactionSendingSigner =
      SolanaMetamaskTransferSignerGenerator.getTransactionSendingSigner(metamaskWallet, "solana:mainnet", account.address);

    const message = pipe(
      createTransactionMessage({version: 0}),
      m => setTransactionMessageFeePayerSigner(transactionSendingSigner, m),
      m => setTransactionMessageLifetimeUsingBlockhash(latestBlockhash, m),
      m =>
        appendTransactionMessageInstruction(
          getTransferSolInstruction({
            amount,
            destination: address(addressArg),
            source: transactionSendingSigner,
          }),
          m,
        ),
    );
    assertIsTransactionMessageWithSingleSendingSigner(message);

    const signedTx = await signAndSendTransactionMessageWithSigners(message);

    return getBase58Decoder().decode(signedTx);
  }

  private async getHexedAddress(): Promise<string> {
    return (await this.enable()).address;
  }

  private getSolanaMetamaskWallet(): Wallet {
    const solanaGetWalletsFeature = getWallets();
    const solanaWallets = solanaGetWalletsFeature.get();
    for (let i = 0; i < solanaWallets.length; i++) {
      if (solanaWallets[i].name.toLowerCase() === "metamask" && solanaWallets[i].chains.includes("solana:mainnet")) {
        return solanaWallets[i];
      }
    }
    return solanaWallets[0];
  }
}
